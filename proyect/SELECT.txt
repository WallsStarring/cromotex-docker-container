**12:02:26/21/2/2022*****
select codigo, codusu  from ws_keys
*************************************************************
**12:02:26/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**12:02:27/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**12:03:27/21/2/2022*****
select codigo, codusu  from ws_keys
*************************************************************
**12:03:27/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**12:03:27/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**12:53:36/21/2/2022*****
select codigo, codusu  from ws_keys
*************************************************************
**12:53:36/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**12:53:36/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:25:49/21/2/2022*****
select codigo, codusu  from ws_keys
*************************************************************
**11:25:49/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:25:50/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:26:07/21/2/2022*****
select codigo, codusu  from ws_keys
*************************************************************
**11:26:07/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:26:08/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:42:21/21/2/2022*****
select codigo, codusu  from ws_keys
*************************************************************
**11:42:21/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:42:21/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:44:24/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**11:44:24/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/02'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/02'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/02'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/02'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**11:44:54/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**11:44:54/21/2/2022*****
select a.lem_id,b.nod_descripcion, a.lem_descripcion from tbllugarembarque_lem a, tblnodos_nod b where a.nod_codigo = b.nod_codigo
*************************************************************
**11:44:58/21/2/2022*****
select codigo, codusu  from ws_keys
*************************************************************
**11:44:58/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:44:58/21/2/2022*****
select a.age_id as agenciaID, a.age_descripcion as agencia, a.age_direccion as direccion from tblagencias_age a
*************************************************************
**11:45:44/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**11:45:44/21/2/2022*****
select a.lem_id,b.nod_descripcion, a.lem_descripcion from tbllugarembarque_lem a, tblnodos_nod b where a.nod_codigo = b.nod_codigo
*************************************************************
**11:46:52/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**11:46:52/21/2/2022*****
select a.lem_id,b.nod_descripcion, a.lem_descripcion from tbllugarembarque_lem a, tblnodos_nod b where a.nod_codigo = b.nod_codigo
*************************************************************
**11:47:16/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**11:47:16/21/2/2022*****
select a.lem_id,b.nod_descripcion, a.lem_descripcion from tbllugarembarque_lem a, tblnodos_nod b where a.nod_codigo = b.nod_codigo
*************************************************************
**12:04:51/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**12:04:51/21/2/2022*****
select a.lem_id,b.nod_descripcion, a.lem_descripcion from tbllugarembarque_lem a, tblnodos_nod b where a.nod_codigo = b.nod_codigo
*************************************************************
**12:11:47/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**12:11:47/21/2/2022*****
select a.lem_id,b.nod_descripcion, a.lem_descripcion from tbllugarembarque_lem a, tblnodos_nod b where a.nod_codigo = b.nod_codigo
*************************************************************
**12:21:41/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**12:21:41/21/2/2022*****
select a.lem_id,b.nod_descripcion, a.lem_descripcion from tbllugarembarque_lem a, tblnodos_nod b where a.nod_codigo = b.nod_codigo
*************************************************************
**12:22:00/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**12:22:00/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/02'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/02'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/02'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/02'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:25:52/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:27:09/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:27:09/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/02'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/02'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/02'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/02'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:36:47/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:36:47/21/2/2022*****
select a.lem_id,b.nod_descripcion, a.lem_descripcion from tbllugarembarque_lem a, tblnodos_nod b where a.nod_codigo = b.nod_codigo
*************************************************************
**01:36:49/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:36:49/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:37:08/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:37:08/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:37:10/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:37:10/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:37:38/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:37:38/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:40:00/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:40:00/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:43:45/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:43:45/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:44:27/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:44:27/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:46:24/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:46:24/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:46:47/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:46:47/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:48:50/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:48:50/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:50:50/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:50:50/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:52:11/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:52:11/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:53:03/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:53:03/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:54:03/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:54:03/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:54:08/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:54:08/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:54:15/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:54:15/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:55:00/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:55:00/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:56:13/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:56:14/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:56:52/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:56:52/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:57:09/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:57:09/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**01:58:21/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**01:58:21/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**02:04:46/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**02:04:46/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**02:04:50/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**02:04:50/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**02:08:58/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**02:08:58/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**02:15:21/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**02:15:21/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**02:15:24/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**02:15:24/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**02:17:30/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**02:17:31/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:12:58/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:12:58/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:19:23/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:19:23/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:20:10/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:20:10/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:20:56/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:20:56/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:21:44/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:21:44/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:22:44/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:22:44/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:22:55/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:22:55/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:23:25/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:23:25/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:23:30/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:23:30/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:23:53/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:23:53/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:24:58/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:24:58/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:25:30/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:25:30/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:26:05/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:26:05/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:26:40/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:26:40/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:27:38/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:27:38/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:28:25/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:28:25/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:29:33/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:29:33/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:34:24/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:34:24/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:34:38/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:34:38/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:35:06/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:35:06/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:40:23/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:40:23/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**03:41:03/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**03:41:03/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:18:56/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:18:56/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:19:17/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:19:17/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:20:03/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:20:03/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022/02/22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022/02/22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022/02/22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:20:16/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:20:16/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:20:46/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:20:46/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:21:29/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:21:29/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:23:27/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:23:27/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:24:14/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:24:14/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:24:49/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:24:49/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:25:10/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:25:10/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:26:20/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:26:20/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:26:55/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:26:55/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:28:05/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:28:05/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:28:31/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:28:31/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:29:53/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:29:53/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:30:58/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:30:58/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:32:22/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:32:22/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:33:31/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:33:31/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:34:37/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:34:37/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:42:59/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:42:59/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:43:28/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:43:28/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:44:37/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:44:37/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:44:58/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:44:58/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:45:19/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:45:19/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:45:48/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:45:48/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:45:49/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:45:49/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:48:59/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:48:59/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:56:31/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:56:31/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:56:58/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:56:58/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:57:44/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:57:44/21/2/2022*****

select c.vhc_numasiento as asiento,
case when c.vhc_numasiento = 0 then 0 else case when c.vhc_piso = 1 then case when c.vhc_tipo = 'AE' then a.via_precio1 else a.via_precio2 end 
else a.via_precio2 end  end as tarifaAsiento, 
case when c.vhc_numasiento = 0 then 0 else case when c.vhc_numasiento in (select vbo_numasiento from pasajes.tblviajesasientos_vbo where via_id = 40946 
and ast_codigo != 'lib' or vbo_numasiento in (54,55,60)) then 0 else 1 end end as estadoAsiento,
c.vhc_x as columna, c.vhc_y as fila, c.vhc_piso as piso,d.MaxAsi as cantidadAsientos, d.MaxCol as cantidadColumnas , d.MaxFil as cantidadFila,
b.veh_pisos as numeroPisos, 
case when c.vhc_numasiento in (select vbo_numasiento from pasajes.tblviajesasientos_vbo where via_id = 40946 and ast_codigo != 'lib') then 7 else
case c.vhc_tipo when 'AE' then 0 when 'AS' then 0 when 'TV' then 1 when 'CF' then 2 when 'SH' then 3 when 'ES' then 4 else 7  end end as tipoObjeto
from dbo.tblviajes_via a,dbo.tblvehiculos_veh b , tblvehiculoscroquis_vhc c ,
(select m.veh_id , m.vhc_piso, max(m.vhc_x ) as MaxCol, max (m.vhc_y ) as MaxFil, count (m.vhc_numasiento ) as MaxAsi from dbo.tblvehiculoscroquis_vhc m, dbo.tblviajes_via n
where m.vhc_numasiento != 0 and n.veh_id = m.veh_id  and n.via_id = 40946 group by m.veh_id, m.vhc_piso) as d
where a.veh_id = b.veh_id and b.veh_id = c.veh_id and a.veh_id = d.veh_id and c.vhc_piso = d.vhc_piso and a.via_ventasinternet = 1 and a.via_id = 40946 and a.rut_id = 17 
      
*************************************************************
**04:58:50/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:58:50/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:59:25/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:59:25/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**04:59:45/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**04:59:45/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:01:27/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:01:27/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:01:29/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:01:30/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:02:13/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:02:13/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:03:46/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:03:46/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:04:13/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:04:13/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:04:38/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:04:38/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:07:20/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:07:20/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:07:37/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:07:37/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:09:55/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:09:55/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:17:12/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:17:12/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:17:23/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:17:23/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:18:38/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:18:38/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:18:49/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:18:49/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:19:02/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:19:02/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:21:03/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:21:03/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:21:15/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:21:15/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:21:20/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:21:20/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:22:17/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:22:17/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:27:40/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:27:40/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:27:48/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:27:48/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:30:49/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:30:49/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**05:35:31/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**05:35:31/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:04:48/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:04:48/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:05:22/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:05:22/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:05:34/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:05:34/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:07:51/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:07:51/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:07:55/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:07:56/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:08:00/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:08:00/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:08:08/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:08:08/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:08:17/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:08:17/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:08:34/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:08:34/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:08:55/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:08:55/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:08:57/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:08:57/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:09:04/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:09:04/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:09:06/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:09:06/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:09:08/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:09:08/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:09:15/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:09:15/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:09:23/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:09:23/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:10:05/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:10:05/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:11:06/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:11:06/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:11:20/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:11:20/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:11:29/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:11:29/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:16:03/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:16:03/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:21:17/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:21:17/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
**06:21:20/21/2/2022*****
select codigo, codusu  from tblws_keys where '#ojIOuhSOhs.98hsoHOh98soijHS8.U908jsoij9856tyug.lkj7wo9jhoa8' =  CONVERT(VARCHAR(MAX), DECRYPTBYPASSPHRASE('password', Llave)) and level = 1
*************************************************************
**06:21:20/21/2/2022*****
select 
      a.via_id as itinerarioID
      , a.rut_id as rutaID
      , e.id as origenID
      , e.descripcion as origen
      , h.id as destinoID
      , h.descripcion as destino
      , 1 as piso,j.cat_id as servicioID
      , j.cat_nombre as servicioNombre
      , a.via_precio1 as tarifa
      , convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
      , cast(a.via_fechaviaje AS date) AS fechaPartida
      , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
      , a.lem_iddesembarque as agenciaLlegadaID
      , f.nod_descripcion as agenciaLlegada
      , m.lem_descripcion as direccionLlegada
      , l.lem_id as agenciaPartidaID
      , c.nod_descripcion as agenciaPartida
      , convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
      , l.lem_descripcion as direccion 
      from dbo.tblviajes_via a 
     inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
     inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo 
     inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
     inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
    inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
     inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
     inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
     inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
     inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
     inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
     inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
     inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje = '2022-02-22'
    
       union all
            select  
            a.via_id as itinerarioID
            , a.rut_id as rutaID
            , e.id as origenID
            , e.descripcion as origen
            , h.id as destinoID
            , h.descripcion as destino
            , i.veh_pisos as piso
            , j.cat_id as servicioID 
            , j.cat_nombre as servicioNombre
            , a.via_precio2 as tarifa
            , convert(varchar(8) , cast (DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
            , cast(a.via_fechaviaje AS date) AS fechaPartida
            , CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
            , a.lem_iddesembarque as agenciaLlegadaID, f.nod_descripcion as agenciaLlegada
            , m.lem_descripcion as direccionLlegada
            , l.lem_id as agenciaPartidaID
            , c.nod_descripcion as agenciaPartida 
            , convert(varchar(8),cast(a.via_horaviaje AS time)) AS horaPartida
            , l.lem_descripcion as direccion 
            from dbo.tblviajes_via a  
         inner join dbo.tblrutas_rut b on  a.rut_id = b.rut_id
         inner join dbo.tblnodos_nod c on b.nod_codigoorigen = c.nod_codigo
         inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
         inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
      inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
         inner join dbo.tblubigeos_ubi g on f.ubi_codigo = g.ubi_codigo
         inner join dbo.tblciudades_ubi h on g.ubi_codigociudad = h.id
         inner join dbo.tblvehiculos_veh i on a.veh_id = i.veh_id and i.veh_pisos = 2
         inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
         inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id
         inner join dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id and l.nod_codigo = b.nod_codigoorigen
         inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
            where 
            a.evi_codigo = 'PEN'
            and a.via_ventasinternet = 1
            and a.cat_id != 7
            and a.via_fechaviaje =  '2022-02-22'

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, 1 as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio1 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

union all
select distinct
a.via_id as itinerarioID
, a.rut_id as rutaID
, e.id as origenID
, c.nod_descripcion as origen
, h.id as destinoID
, h.descripcion as destino
, i.veh_pisos as piso,j.cat_id as servicioID
, j.cat_nombre as servicioNombre
, a.via_precio2 as tarifa
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', b.rut_tiempoviaje),'00:00:00' ) as time(1))) as horaLlegada 
, cast(a.via_fechaviaje AS date) AS fechaPartida
, CAST(dateadd(day, datediff(day,'19000101',a.via_fechaviaje), CAST(a.via_horaviaje as datetime)) + CAST(b.rut_tiempoviaje as datetime) as date) as fechaLlegada
, a.lem_iddesembarque as agenciaLlegadaID
, f.nod_descripcion as agenciaLlegada
, m.lem_descripcion as direccionLlegada
, lem.lem_id as agenciaPartidaID
, nod.nod_descripcion as agenciaPartida
--, convert(varchar(8), cast(a.via_horaviaje AS time)) AS horaPartida
--,rxn.rxn_tiempoviaje
, convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', a.via_horaviaje)+DATEDIFF(S,'00:00:00', rxn.rxn_tiempoviaje),'00:00:00' ) as time(1))) AS horaPartida2
, lem.lem_descripcion as direccion 
from dbo.tblviajes_via a 
inner join dbo.tblrutas_rut b on a.rut_id = b.rut_id 
inner join tblrutasnodos_rxn rxn on a.rut_id=rxn.rut_id
inner join dbo.tblnodos_nod nod on rxn.nod_codigo = nod.nod_codigo 
inner join  dbo.tbllugarembarque_lem lem on nod.nod_codigo = lem.nod_codigo
inner join dbo.tblviajeslugarembarque_vle k on a.via_id = k.via_id 
inner join  dbo.tbllugarembarque_lem l on l.lem_id = k.lem_id --and l.nod_codigo = b.nod_codigoorigen
inner join dbo.tblnodos_nod c on l.nod_codigo = c.nod_codigo 
inner join dbo.tblubigeos_ubi d on c.ubi_codigo = d.ubi_codigo
inner join dbo.tblciudades_ubi e on d.ubi_codigociudad = e.id
inner join dbo.tblnodos_nod f on b.nod_codigodestino = f.nod_codigo
inner join dbo.tblubigeos_ubi g on  f.ubi_codigo = g.ubi_codigo
inner join dbo.tblciudades_ubi h on  g.ubi_codigociudad = h.id
inner join dbo.tblvehiculos_veh i on  a.veh_id = i.veh_id
inner join dbo.tblcategorias_cat j on i.cat_id = j.cat_id
inner join dbo.tbllugarembarque_lem m on a.lem_iddesembarque = m.lem_id
where 
a.evi_codigo = 'PEN'
and a.via_ventasinternet = 1
--and l.nod_codigo = b.nod_codigoorigen
and i.veh_pisos = 2
and a.cat_id != 7
and a.via_fechaviaje = '2022-02-22'
and convert(varchar(8),cast(DATEADD(S,DATEDIFF(S,'00:00:00', (select rxn_tiempoviaje from tblrutasnodos_rxn where nod_codigo=c.nod_codigo AND rut_id=a.rut_id)),cast(a.via_horaviaje as time)) as time)) between '09:00' and '23:30'
and e.id in (12/*NASCA*/)
and lem.lem_id in (1009/*NASCA*/)

*************************************************************
